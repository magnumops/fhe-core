# Реестр Отвергнутых Гипотез и Ошибок (POSTMORTEM)

## Сессия: Фаза 1 (Integration Skeleton)
### Эпизод: Подключение Verilator к CMake в Docker

| ID | Гипотеза / Проблема | Предпринятое Действие | Результат | Анализ Провала (Root Cause) |
| :--- | :--- | :--- | :--- | :--- |
| PM-001 | `find_package(Verilator)` автоматически найдет пути в Ubuntu 22.04. | Использован стандартный `find_package`. | Ошибка CMake: переменные путей остались пустыми. | В пакете `verilator` для Ubuntu 22.04 отсутствуют корректные `.cmake` конфиги для автопоиска. |
| PM-002 | Verilator найдет исходники `.v`, если запустить его из папки `build`. | `COMMAND verilator ... src/rtl/counter.v` | Ошибка Verilator: `Cannot find file`. | Verilator (как и многие CLI утилиты) чувствителен к CWD. При запуске из `build` относительный путь `src/` неверен. Требуется абсолютный путь `${CMAKE_SOURCE_DIR}`. |
| PM-003 | Достаточно добавить основные `.cpp` файлы Verilator в `add_executable`. | Добавлены `Vcounter.cpp` и `Vcounter__Syms.cpp`. | Linker Error: `undefined reference to Vcounter::Vcounter`. | Линковщику не хватило файла `Vcounter__Slow.cpp`, где Verilator прячет конструкторы. |
| PM-004 | Если добавить все файлы в `add_executable`, CMake сам поймет, что их надо сгенерировать. | Добавлен `Vcounter__Slow.cpp` в цель сборки, но не в `OUTPUT` команды генерации. | CMake Error: `Cannot find source file`. | CMake проверяет наличие исходников *до* сборки. Если файл генерируемый, он ОБЯЗАН быть в списке `OUTPUT` той команды, которая его создает. |


## Успешное завершение Фазы 1
**Статус:** Скелет готов.
**Достижение:** Реализован класс `CounterSim` с методами `step()` и `reset()`. Python-тест прошел валидацию. Риски интеграции языков и инструментов устранены.

## Успешное завершение Дня 5
**Статус:** Mmap Spike пройден.
**Достижение:** Успешно аллоцирован 1 ТБ виртуальной памяти. Тест записи в начало, середину и конец файла прошел успешно.

## Успешное завершение Дня 6
**Статус:** DPI Bridge функционирует.
**Инциденты:**
1. `ModuleNotFoundError`: Забыли добавить путь к build. Исправлено через `sys.path`.
2. `Verilog read: 0x0`: Попытка записи в память до инициализации симулятора. Исправлено изменением порядка вызовов в тесте.
**Достижение:** Реализован сквозной доступ к данным: Python -> C++ (Mmap) -> Verilog (DPI).

## Успешное завершение Фазы 2
**Статус:** Память и DPI готовы.
**Достижение:** Реализована эмуляция 1 ТБ памяти через mmap. Реализован пакетный (Burst) режим передачи данных в Verilog.
**Ключевой урок:** Типы данных на границе языков (Verilog/C++) критичны. `reg` != `uint64_t`.

## Успешное завершение Дня 8
**Статус:** Интеграция SEAL (BFV Scheme) работает.
**Инциденты:**
1. Синтаксическая ошибка C++ (забытый инклюд).
2. Ошибка импорта Python (неверный порядок строк).
**Достижение:** Эмулятор теперь умеет выполнять реальное гомоморфное сложение.

## Успешное завершение Дня 10 (ФИНАЛ)
**Статус:** "Золотая Петля" работает.
**Инциденты:**
1. **Синтаксис C++:** Ошибки с `#` комментариями и областью видимости PyBind.
2. **Крипто-конфигурация:** `plain_modulus=1024` был слишком мал для числа 1337. Увеличили до 65537.
3. **Hardware Buffer Underrun:** Буфер в Verilog (4 КБ) был меньше размера шифртекста (88 КБ). Данные обрезались, расшифровка падала. Исправлено увеличением буфера до 128 КБ.
**Достижение:** Полный цикл данных (Python -> FHE -> RAM -> Verilog -> RAM -> FHE -> Python) верифицирован.

## Сессия: Фаза 2 (NTT Arithmetic Units)
### Эпизод: День 2 - Сборка Модулей Арифметики

| ID | Гипотеза / Проблема | Предпринятое Действие | Результат | Анализ Провала (Root Cause) |
| :--- | :--- | :--- | :--- | :--- |
| PM-P2-001 | Сгенерированные Verilator хедеры (`Vmodel.h`) автоматически видны компилятору C++ внутри CMake build folder. | Использован стандартный `pybind11_add_module` без добавления build-директории в include. | Build Error: `fatal error: Vcopy_engine.h: No such file`. | CMake не добавляет `CMAKE_CURRENT_BINARY_DIR` в пути поиска хедеров автоматически. Компилятор не знал, где лежат сгенерированные файлы. |
| PM-P2-002 | Verilog позволяет неявное расширение типов (авто-кастинг 64->65 бит). | Написан код `wire [64:0] s = a + b` (где a,b 64 бита). | Build Error (Lint): `Operator ASSIGNW expects 65 bits`. | Verilator в строгом режиме требует явного приведения типов. Нельзя складывать 64-битные числа и класть в 65 бит без явного паддинга `{1'b0, a}`. |
| PM-P2-003 | Файл `verilated_dpi.cpp` нужен только модулям, использующим Open Arrays. | Исключен `verilated_dpi.cpp` из цели `ntt_tester`. | Linker Error: `undefined symbol: svGetArrElemPtr1`. | DPI-символы часто являются глобальными или тянутся транзитивно. Если хоть один модуль в проекте (даже соседний) использует DPI Open Arrays, линковщик требует наличия реализации. |

## Сессия: Фаза 2 (NTT Arithmetic Units)
### Эпизод: День 2 - Сборка Модулей Арифметики

| ID | Гипотеза / Проблема | Предпринятое Действие | Результат | Анализ Провала (Root Cause) |
| :--- | :--- | :--- | :--- | :--- |
| PM-P2-001 | Сгенерированные Verilator хедеры (`Vmodel.h`) автоматически видны компилятору C++ внутри CMake build folder. | Использован стандартный `pybind11_add_module` без добавления build-директории в include. | Build Error: `fatal error: Vcopy_engine.h: No such file`. | CMake не добавляет `CMAKE_CURRENT_BINARY_DIR` в пути поиска хедеров автоматически. Компилятор не знал, где лежат сгенерированные файлы. |
| PM-P2-002 | Verilog позволяет неявное расширение типов (авто-кастинг 64->65 бит). | Написан код `wire [64:0] s = a + b` (где a,b 64 бита). | Build Error (Lint): `Operator ASSIGNW expects 65 bits`. | Verilator в строгом режиме требует явного приведения типов. Нельзя складывать 64-битные числа и класть в 65 бит без явного паддинга `{1'b0, a}`. |
| PM-P2-003 | Файл `verilated_dpi.cpp` нужен только модулям, использующим Open Arrays. | Исключен `verilated_dpi.cpp` из цели `ntt_tester`. | Linker Error: `undefined symbol: svGetArrElemPtr1`. | DPI-символы часто являются глобальными или тянутся транзитивно. Если хоть один модуль в проекте (даже соседний) использует DPI Open Arrays, линковщик требует наличия реализации. |
