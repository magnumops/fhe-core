# Architectural Decision Records (ADR) - Phase 3

## ADR-001: Синтезируемая Арифметика (Barrett Reduction)
*   **Дата:** Day 1
*   **Проблема:** Использование операторов `%` и `/` в Verilog делает дизайн несинтезируемым для ASIC/FPGA.
*   **Решение:** Заменить деление на умножение сдвигом, используя алгоритм редукции Барретта с предвычисленной константой $\mu = \lfloor 2^{64} / Q \rfloor$.
*   **Статус:** Внедрено.

## ADR-002: Выделенный Vector ALU
*   **Дата:** Day 2
*   **Проблема:** Монолитный `ntt_arith_unit` сложен для тестирования простых операций.
*   **Решение:** Выделить модуль `vec_alu.v` (Combinatorial), поддерживающий операции ADD, SUB, MULT над векторами.
*   **Статус:** Внедрено.

## ADR-003: Динамические RNS Параметры
*   **Дата:** Day 3
*   **Проблема:** Эмулятор был привязан к одному набору констант (hardcoded).
*   **Решение:** Параметризовать все модули. Ввести `q`, `mu`, `n_inv` как входные сигналы верхнего уровня, управляемые из C++.
*   **Статус:** Внедрено.

## ADR-004: Архитектура Command Processor
*   **Дата:** Day 4
*   **Проблема:** Прямое управление пинами (`start`, `mode`) из C++ не масштабируется и создает "лапшу" в коде.
*   **Решение:** Внедрить ISA (64-bit instruction: Opcode 8b + Payload 56b) и модуль `command_processor.v`. Связь через DPI `dpi_get_cmd`.
*   **Статус:** Внедрено.

## ADR-005: Многобанковая Память (Multi-Bank Memory)
*   **Дата:** Day 5
*   **Проблема:** Stateless режим требует постоянной гонки данных через PCIe (DPI).
*   **Решение:** Внутренняя память разделена на 4 банка (Slots). Введены команды `LOAD` (Host->Slot) и `STORE` (Slot->Host). Вычисления происходят внутри FPGA (In-Place).
*   **Статус:** Внедрено.

## ADR-006: Гибридная Перестановка (Hybrid Bit-Reversal)
*   **Дата:** Day 7
*   **Проблема:** Аппаратный INTT требует данные в Bit-Reversed порядке, но аппаратный NTT выдает Natural.
*   **Решение:** В качестве временного решения (MVP) реализовать перестановку на стороне Host (C++/Python). SDK автоматически скачивает, переставляет и загружает данные обратно перед INTT.
*   **Статус:** Внедрено (Workaround).
