# Logos FHE Accelerator Emulator (v6.0 Dual Core RNS)

## üöÄ –¢–µ–∫—É—â–∏–π –°—Ç–∞—Ç—É—Å
**–§–∞–∑–∞ 6 –ó–∞–≤–µ—Ä—à–µ–Ω–∞ (Diamond Loop Dual Verified).**
–°–∏—Å—Ç–µ–º–∞ —É—Å–ø–µ—à–Ω–æ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–ª–∞ –≤ **–¥–≤—É—Ö—ä—è–¥–µ—Ä–Ω—ã–π RNS-—Å–æ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä**.
*   **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –†–µ–∞–ª—å–Ω—ã–µ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ —è–¥—Ä–∞ (`ntt_engine.v`) –∑–∞–º–µ–Ω–∏–ª–∏ –∑–∞–≥–ª—É—à–∫–∏.
*   **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º:** –î–≤–∞ —è–¥—Ä–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (Round-Robin Arbiter).
*   **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª BFV (Load -> NTT -> Mult -> INTT -> Store) —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–º–µ–Ω—ã –º–æ–¥—É–ª—è (RNS).

---

## üèõ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ v6.0

### 1. Top Level (`logos_core.v`)
*   **Dual Core:** –ò–Ω—Å—Ç–∞–Ω—Ü–∏—Ä—É–µ—Ç –¥–≤–∞ –º–æ–¥—É–ª—è `ntt_core` (ID=0, ID=1).
*   **Command Processor:** –î–∏—Å–ø–µ—Ç—á–µ—Ä –∫–æ–º–∞–Ω–¥. –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∏—Ç–∞ [48] –∞–¥—Ä–µ—Å–∞ –∫–æ–º–∞–Ω–¥—ã (Target Core Bit).
*   **Memory Arbiter:** 3-–ø–æ—Ä—Ç–æ–≤—ã–π –∞—Ä–±–∏—Ç—Ä (DMA Host, Core 0, Core 1).
    *   *–†–µ–∂–∏–º:* Blocking Round-Robin (—á–µ—Å—Ç–Ω–æ–µ —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ).
    *   *–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:* –ë–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —á—Ç–µ–Ω–∏–µ –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ (Valid), –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è —Å–º–µ—à–∏–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

### 2. –í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–µ –Ø–¥—Ä–æ (`ntt_engine.v`)
"–°–µ—Ä–¥—Ü–µ" —Å–∏—Å—Ç–µ–º—ã. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ª–∏–Ω–æ–º–æ–≤.
*   **FSM States:** IDLE, DMA_READ, DMA_WRITE, CALC, CONFIG, ALU.
*   **Local Memory:** 4 –±–∞–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö (SRAM) + –ü–∞–º—è—Ç—å Twiddle Factors.
*   **Execution Units:**
    *   **NTT/INTT:** –ê–ª–≥–æ—Ä–∏—Ç–º Cooley-Tukey (Radix-2).
    *   **Vector ALU:** –ü–æ—ç–ª–µ–º–µ–Ω—Ç–Ω–æ–µ —Å–ª–æ–∂–µ–Ω–∏–µ –∏ —É–º–Ω–æ–∂–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–æ–≤ (`vec_alu.v`).
*   **DMA Controller:**
    *   *Read:* Pipelined —Å Address Lookahead.
    *   *Write:* Burst Mode "Fire-and-Forget" (–¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏).

### 3. RNS & Config
–Ø–¥—Ä–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é —Å–º–µ–Ω—É –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ "–Ω–∞ –ª–µ—Ç—É".
*   **Config Registers:** `q` (Modulus), `mu` (Barrett precalc), `n_inv`.
*   **–ú–µ—Ö–∞–Ω–∏–∑–º:** –ö–æ–º–∞–Ω–¥–∞ `OPC_CONFIG` –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ –ø–∞–º—è—Ç–∏ –≤ —Ä–µ–≥–∏—Å—Ç—Ä—ã —è–¥—Ä–∞.

---

## üíæ –ö–∞—Ä—Ç—ã –ü–∞–º—è—Ç–∏ –∏ –ö–æ–º–∞–Ω–¥—ã

### Instruction Set Architecture (ISA v6)
–§–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã (64-–±–∏—Ç): `[Opcode 8] [Slot 4] [Target 1] [Addr 48]`

| Opcode | Mnemonic   | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| `0x02` | `LOAD`     | –ó–∞–≥—Ä—É–∑–∫–∞ –≤–µ–∫—Ç–æ—Ä–∞ (N —Å–ª–æ–≤) –∏–∑ RAM –≤ SRAM Slot. |
| `0x03` | `STORE`    | –í—ã–≥—Ä—É–∑–∫–∞ –≤–µ–∫—Ç–æ—Ä–∞ –∏–∑ SRAM Slot –≤ RAM. |
| `0x04` | `LOAD_W`   | –ó–∞–≥—Ä—É–∑–∫–∞ Twiddle Factors (2*N —Å–ª–æ–≤). |
| `0x05` | `CONFIG`   | –ó–∞–≥—Ä—É–∑–∫–∞ RNS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (3 —Å–ª–æ–≤–∞: q, mu, n_inv). |
| `0x10` | `NTT`      | –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä—è–º–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ. |
| `0x11` | `INTT`     | –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ. |
| `0x20` | `ADD`      | –°–ª–æ–∂–µ–Ω–∏–µ: `Slot[i] = Slot[i] + Source[i]`. |
| `0x22` | `MULT`     | –£–º–Ω–æ–∂–µ–Ω–∏–µ: `Slot[i] = Slot[i] * Source[i]`. |

### Global Memory Map (Convention)
*   `0x00000 - 0x0FFFF`: System / Config Region.
*   `0x10000`: Vector A.
*   `0x20000`: Vector B.
*   `0x30000`: Exchange Buffer.
*   `0x40000`: Output Buffer.
*   `0x80000`: Twiddle Factors Table.

---

## üõ† Software Stack

### 1. Python SDK (`logos_sdk.py`)
–í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç–º—É–ª—è—Ç–æ—Ä–æ–º.
```python
driver = logos_sdk.LogosDriver(logos_emu)
driver.load_data(core_id=0, slot=0, addr=0x10000)
driver.run_ntt(core_id=0)
```

### 2. C++ Driver (`emulator_core.cpp`)
*   –°–≤—è–∑—ã–≤–∞–µ—Ç Python (PyBind11) –∏ Verilator.
*   –†–µ–∞–ª–∏–∑—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é `push_command(cmd, timeout)` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Hold Time –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å RTL.
*   –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç–æ–¥—ã –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–º—è—Ç–∏ (`read_ram`, `write_ram`).

### 3. Memory Model (`dpi_impl.cpp`)
*   `std::map<long long, long long>` —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω—É—é –ø–∞–º—è—Ç—å (Sparse Memory).
*   **Hybrid Bridge:** –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Å–∏–º–≤–æ–ª—ã –∫–∞–∫ `dpi_` (–¥–ª—è Verilog), —Ç–∞–∫ –∏ `py_` (–¥–ª—è Legacy) –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º –ª–∏–Ω–∫–æ–≤–∫–∏.

---

## üî¨ How to Run

### –°–±–æ—Ä–∫–∞ –∏ –¢–µ—Å—Ç—ã
–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ Docker –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏.

```bash
cd VM
# 1. –°–±–æ—Ä–∫–∞ –û–±—Ä–∞–∑–∞ (–≤–∫–ª—é—á–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—é Verilator –∏ C++)
docker build -t logos-dev:v6 .

# 2. –ó–∞–ø—É—Å–∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ (Diamond Loop)
docker run --rm logos-dev:v6 python3 tests/day10/test_diamond_final.py
```

### –û—Ç–ª–∞–¥–∫–∞
–í RTL –≤–∫–ª—é—á–µ–Ω `TraceGuard` –∏ –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ `$display` (—Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è –ø–æ `CORE_ID`).
–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ docker run.

